# DirectoryX - 高级目录结构化与内容准备工具

DirectoryX 是一款精心设计的基于Web的实用工具，旨在帮助您可视化目录结构、以精细的控制管理文件内容，并导出经过筛选的选集。其主要设计目标是为**功能强大、拥有大型上下文窗口但可能不支持直接文件上传的非多模态大型语言模型 (LLM) 准备高价值、与上下文相关的代码和文本**。

虽然简单地串联项目文件是一项微不足道的任务，但 DirectoryX 的独特优势在于其**高度灵活的多层过滤机制和高效的操作能力**。它对包含哪些内容以及如何处理内容提供了细致的控制，使用户能够显著减少低价值的文本信息。尽管掌握其高级功能需要一定的学习成本，但其回报是巨大的：显著改善AI分析的上下文质量，从而获得更准确的洞察，并大幅减少token消耗。

## 主要功能

*   **智能目录导入**:
    *   使用文件系统访问 API 导入本地项目目录 (需要在兼容的浏览器如 Chrome/Edge 的安全上下文中运行)。
    *   如果 API 不可用或用户取消，则加载一个示例项目，方便您全面体验各项功能。
    *   **性能优化**: 实现延迟内容加载——首先构建结构树，应用导入规则，然后仅加载通过筛选的文件的内容。
*   **交互式文件树**:
    *   清晰地可视化项目的文件和文件夹结构。
    *   展开/折叠文件夹以聚焦视图。
    *   高效搜索文件 (`Ctrl+F`) 和文件夹 (`Ctrl+Shift+F`)。
*   **精细化的文件选择与操作**:
    *   单独选择文件以进行精确导出。
    *   文件夹的批量选择选项 (全选、全不选、反选文件夹内的文件)。
*   **内容管理与覆盖**:
    *   **文件/文件夹属性**: 添加自定义描述 (在合并导出时作为注释附加在文件内容开头)。
    *   **文件特定覆盖**: 微调行数限制 (例如，头部N行、尾部N行、特定范围、无行) 和压缩方式 (去除空行、去除注释)，这些设置将优先于该特定文件的全局规则集配置。
*   **强大的匹配库**:
    *   创建和管理可复用的“匹配项”，用于识别文件或文件夹。
    *   **严格的类型区分**: 匹配项明确定义为针对“文件”或“文件夹”。
    *   **高级匹配类型**:
        *   **名称**: 完全或部分名称匹配。
        *   **后缀**: 针对文件 (例如 `.txt`, `.js`)。
        *   **通配符 (名称)**: 类 Glob 模式用于名称 (例如 `*.log`, `file?.ts`)。
        *   **正则表达式 (名称)**: 用于复杂的名称模式匹配。
        *   **路径通配符**: 类 Glob 模式用于完整相对路径 (例如 `src/modules/**/tests`, `.yarn/cache`, `dist/**/*.js`)。
        *   **路径正则表达式**: 用于复杂的路径模式匹配。
*   **精密的规则集**:
    *   将规则组织成具有优先级的集合，用于不同的处理阶段，确保精确控制。
    *   **导入规则集**: 定义初始导入或排除哪些文件和文件夹。这是抵御无关内容的第一道防线 (例如，基于名称或路径排除 `node_modules`, `.git`, 构建产物)。
    *   **压缩规则集**: 对符合特定条件的文件应用内容压缩 (去除空行、多种语言的基本注释移除)。
    *   **行数限制规则集**: 控制导出文件包含的行数 (例如，头部N行、尾部N行、自定义范围，或对二进制文件不保留行)，适用于符合特定条件的文件，对token管理至关重要。
*   **高效的宏操作**:
    *   **操作**: 定义基于先前定义的匹配项的特定动作，如“勾选文件”、“取消勾选文件”、“全选文件夹内文件”等。操作会尊重其匹配项的文件/文件夹目标类型。
    *   **宏**: 创建这些操作的序列，以自动化复杂或重复的选择/取消选择任务。宏可以在“文件”视图中运行。
*   **多样化的导出选项**:
    *   **合并导出选中的文件**: 将所有选定文件的内容（应用选择的压缩和行数限制规则后）合并到单个文本文件中。包含有关应用的规则的元数据。
    *   **导出目录树**: 导出一个表示目录结构的文本文件 (可选择显示已选中的文件)。
*   **稳健的撤销/重做**:
    *   撤销/重做对文件选择和属性的更改 (快捷键 `Ctrl+Z` / `Ctrl+Y`)。
    *   撤销/重做宏的执行，允许无顾虑地进行实验。
*   **以用户为中心的界面**:
    *   文件、匹配库、规则集、宏操作的标签页导航。
    *   用于创建/编辑项目的直观模态框。
    *   用于提供指导的工具提示。
    *   支持PWA，可离线使用和“安装”应用。
    *   通过 `localStorage` 持久化所有用户配置。

## 如何使用

1.  **导航至 “文件” 视图。** 这是默认打开的视图。
2.  **导入目录**: 点击 “导入目录” 按钮。如果API不可用，将加载一个示例项目。
3.  **掌握核心：匹配、规则与规则集 (高效过滤的关键)**:
    *   **“匹配库” 视图**: 定义可复用的匹配项。这是基础。请注意“目标类型”(文件/文件夹) 和各种“匹配类型”(名称、后缀、路径通配符等)。
    *   **“规则集” 视图**:
        *   选择一个规则集类型 (导入、压缩、行数限制)。
        *   在左侧的“规则库”面板中创建规则。规则会使用您已定义的匹配项。
        *   创建新的规则集或修改默认规则集。将规则添加到您的规则集中，调整其优先级 (数字越小，优先级越高) 和启用状态。
    *   **激活规则集**: 在 **“文件”** 视图中，为导入、压缩和行数限制选择所需的活动规则集。导入规则集至关重要，因为它在目录导入过程中应用，以便在加载内容*之前*过滤结构。
4.  **选择要导出的文件**: 在“文件”视图中手动勾选，或使用文件夹级别的批量操作。
5.  **使用宏进行自动化 (可选)**:
    *   前往 **“宏操作”** 视图。首先定义操作 (操作会使用匹配库中的匹配项)，然后将它们组合成宏。
    *   在“文件”视图中运行宏。
6.  **覆盖属性 (可选)**: 使用文件/文件夹旁边的属性图标 (齿轮) 来为特定项设置描述、行数限制或压缩覆盖。
7.  **导出**: 选择所需的导出格式。

*学习曲线提示*: DirectoryX 提供了一个强大的分层系统。投入时间去理解匹配项、规则、规则集和宏之间如何相互作用，将释放其全部潜力，使您能够为AI构建高效且精确的上下文。

## 项目目的与AI交互优势

DirectoryX 专门用于解决与高级LLM协作时的一个常见挑战：为它们提供来自多文件项目的全面而简洁的上下文，尤其是在不支持直接文件上传的情况下。

*   **克服Token限制**: LLM具有有限的上下文窗口。发送未经过滤的项目代码 (例如，包含 `node_modules`、大量注释、日志或大型二进制文件的文本表示) 会迅速消耗token，减少了有意义交互或分析的空间。DirectoryX 使您能够：
    *   **积极排除无关内容**: 使用带有名称和路径匹配的导入规则，在它们被完全处理*之前*就过滤掉整个目录 (如 `node_modules`, `.git`, 构建输出) 和无关的文件类型。
    *   **优化文本内容**: 应用压缩规则 (去除空行、注释) 和行数限制规则 (仅保留文件的基本部分)，以在不丢失核心信息的情况下进一步减少token数量。
*   **提高AI精确度**: 通过提供更清晰、更集中的数据集，您可以使AI：
    *   专注于项目中最相关的部分。
    *   减少被样板代码或无关文本/代码分心的机会。
    *   生成更准确的分析、摘要或代码。
*   **高效的工作流程**: DirectoryX 提供以下功能，而不是手动整理文件和粘贴内容：
    *   **可复用的配置**: 通过匹配项、规则和规则集一次性定义您的过滤和选择逻辑，然后将其重新应用于不同的项目或项目状态。
    *   **自动化**: 使用宏通过单击执行复杂的选择。
*   **结构化输出**: 合并导出格式包含文件路径和描述，帮助AI理解每个代码片段的来源和上下文。

从本质上讲，DirectoryX 将项目目录的原始、嘈杂的现实转化为为LLM消费量身定制的、精简的、高信噪比的输入。

## 设计理念与未来展望

DirectoryX 的核心是一个强大的、分层的系统，构建于以下概念之上：

1.  **匹配项 (Matches)**: 基于各种标准 (名称、路径、类型) 识别特定文件或文件夹的原子单元。
2.  **规则 (Rules) / 操作 (Operations)**: 这些单元消费匹配项来定义具体的动作。
    *   **规则** 在规则集内用于被动处理 (例如，导入/排除，压缩，限制行数)。
    *   **操作** 在宏内用于主动选择任务 (例如，勾选文件，全选文件夹内内容)。
3.  **规则集 (Rulesets) / 宏 (Macros)**: 这些是组织和应用规则或操作的集合。
    *   **规则集** 为特定的处理阶段 (导入、压缩、行数限制) 应用一组具有优先级的规则。
    *   **宏** 执行一系列操作以自动化用户交互。

这种“匹配项 → 规则/操作 → 规则集/宏”的架构提供了高度的灵活性和可组合性。

**未来构想**: 这个稳健的过滤和操作系统的潜力超出了其当前的应用范围。我们设想其核心逻辑可以被抽象为一个**独立的、开源的过滤库**。想象一下一个“高级的 `.gitignore`”，它不仅是声明性的，而且能够动态适应以生成其规则的用户界面，从而使复杂的过滤逻辑易于访问和管理。这样的库可以在需要复杂数据选择和处理流程的各种其他领域中找到应用价值。

## 许可证

本项目根据 [MIT 许可证](README.md) 发布。
